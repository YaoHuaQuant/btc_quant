# BTC Quant-V2
---

## Desc

- BTC 量化分析/交易 系统

### 与V1的差异
- 编程语言
  - V1使用python
  - V2使用rust
- 标的物
  - V1只针对单个标的物（U本位合约）
  - V2考虑多个标的物的组合（U本位合约做空+现货+币本位合约做多）
  - V2同时考虑合约的资金费率
- 策略优化
  - 仓位控制优化
  - 

## 产品
### 需求
 - 主要目标：资产增值，在保障资金安全的前提下，尽可能提高收益率。
 - 数据报表展示
   - 交易数据 汇总/明细
   - 分析数据 汇总/明细
     - 用户自定义分析指标
 - 用户操作：
   - 紧急熔断：暂停交易、一键平仓、降低杠杆、锁定最大仓位 等
### 架构
 - UI
   - web端
   - 移动端
 - 功能
   - 数据展示
     - 交易数据
     - 分析数据
   - 用户操作
     - 添加指标
     - 紧急熔断
       - 仓位控制：暂停交易、一键平仓、降低杠杆、锁定最大仓位 等
       - 订单控制：挂单、撤单、调整价格

## 技术架构
 - UI
   - web端
   - 移动端
 - 采集模块
   - 存储：clickhouse
   - 采集：对接交易所api
   - 指标：
     - 币本位合约-价格、交易量、资金费率
     - U本位合约-价格、交易量、资金费率
     - 现货-价格、交易量
 - 分析模块
   - 自定义指标
   - 数据分析
 - 策略模块
   - 备注：策略模块使用事件驱动模型，仅在特定事件（比如定时事件）时被唤醒执行。
   - 资金管理-仓位、杠杆
   - 订单管理
     - 订单状态：待开仓、已开仓、已平仓、已取消
 - 交易模块
   - 回测模拟交易
   - 实盘交易

## 指标
 - 现有指标
   - 最大振幅
     - 定义：
       - 最大振幅（绝对）=最高价-最低价
       - 最大振幅（相对）=（最高价-最低价）/（市价 or 开盘价格 or 收盘价格）
   - 20日历史波动率（HV）
     - 定义：历史波动率是基于过去一段时间内资产价格的标准差，反映资产价格的波动程度。
   - 布林带宽度（BBW）
     - 布林带宽度是布林带上轨和下轨之间的宽度（4倍标准差），反映市场波动性。
   - 隐含波动率（IV）
     - 通过期权市场价格和Black-Scholes模型反推得出，能够反映市场对未来波动率的预期。
   - 强弱指数（RSI）
   - 平均真实波幅（ATR）
   - 真实波幅（TR）
 - 自定义指标
   - 价格运动路径长度
     - 定义：
       1. 在较细的时间粒度内（比如1分钟），统计（最高价-最低价）*2 - abs（开盘价-收盘价）
       2. 在较粗的时间粒度内（比如1天），统计周期内细粒度区间的“价格运动路径长度”并求和，作为该周期的“价格运动路径长度”。
     - 含义：统计时间内价格变动的最小值
   - 折叠率
     - 定义：在较粗的时间粒度内（比如1天），价格运动路径长度/最大振幅
     - 含义：
       - “折叠率”是路径长度总和除以最大振幅，这个比值可能用来衡量价格在一天内的波动效率或密集程度。如果比值高，说明价格在一天内频繁波动但整体振幅不大，可能处于整理阶段；比值低则可能表明价格波动集中在少数时间段，趋势明显。
       - 折叠率越高，越适合做多波动率。
     - 创新点：该比值可反映市场参与者的交易活跃度。例如，高比值（路径长但振幅小）可能表明多空双方频繁拉锯，但未形成明确趋势；低比值则可能对应单边行情。

## 策略优化
 - 仓位控制优化:
   - V1中，根据当前BTC价格，强制限制最大的仓位比例。
   - V2中，考虑使用 凯利公式+控制策略，动态地调整仓位。
     - 凯利公式：
       - 定义：仓位占比对投资策略的EV有影响，使用赔率、胜率，能够计算出EV最高的仓位占比-“最优仓位占比”。
       - 解释：
         - 赔率：根据止盈点位计算，而止盈点位由人工设定获得。在不上杠杆的前提下，本策略不进行止损操作。
         - 胜率：基于历史数据计算得出，具体计算公式参考期权定价模型。
         - 提高收益的策略：低价&高赔率
           - 在固定赔率的前提下，BTC价格越低，开仓的 胜率/单位时间收益率 越高。
           - 在固定开仓价格的前提下，赔率越低（止盈点位越低），开仓的 胜率/单位时间收益率 越高。
     - 控制策略：
       - 控制目标：最优仓位占比
       - 输入信号：实际仓位占比
       - 控制量：订单密度/订单价格
       - 控制算法：PID反馈控制
 - 订单价格分布优化：
   - V1中，开仓订单的价格是在开仓区间内均匀分布的，而平仓订单的价格不是均匀分布的，而是基于开仓价格进行动态调整的。
   - V2中，考虑将平仓订单的价格，调整成在平仓区间内均匀分布。
 - 模式识别&参数优化
   - 模式识别：
     - 根据相关参数，将BTC的k线走势进行划分，比如分类为 上涨模式、震荡模式、下跌模式。
   - 参数优化：
     - 在不同模式下进行优化，分别计算出收益率最高的参数。


